# 启动脚本使用说明

## 脚本说明

项目提供了两个管理脚本：

1. **start.sh** - 启动/重启服务（智能模式：如果服务未运行则启动，如果已运行则先停止再启动）
2. **stop.sh** - 停止服务

## 功能特性

### start.sh（启动/重启脚本）

- ✅ **智能启动模式**：如果服务未运行则直接启动，如果已运行则先停止再启动（重启模式）
- ✅ **自动检查旧进程**：启动前自动查找并停止之前运行的进程
- ✅ **端口冲突处理**：自动检测并释放被占用的端口
- ✅ **自动构建前端和后端**：如果需要，自动构建前端（React）和后端（Go）
- ✅ **后台运行**：服务在后台运行，输出重定向到日志文件
- ✅ **PID管理**：保存进程ID到 `.opensqt.pid` 文件，方便管理

### stop.sh（停止脚本）

- ✅ **优雅停止**：先发送TERM信号，等待进程退出
- ✅ **强制停止**：如果进程未响应，自动强制停止
- ✅ **进程查找**：支持通过PID文件和进程名查找


## 使用方法

### 启动服务

```bash
# 使用默认配置文件 config.yaml
./start.sh

# 使用自定义配置文件
./start.sh my_config.yaml
```

### 停止服务

```bash
./stop.sh
```

### 重启服务

```bash
# start.sh 本身就是重启模式，如果服务已运行会自动重启
./start.sh

# 使用自定义配置文件
./start.sh my_config.yaml
```

## 端口配置

### 默认端口

- **后端Web服务**：28888（使用10000以上端口，避免常见端口冲突）
- **前端开发服务器**：15173（使用10000以上端口，避免常见端口冲突）

### 修改端口

在 `config.yaml` 中修改：

```yaml
web:
  enabled: true
  host: "0.0.0.0"
  port: 28888  # 修改为你想要的端口（建议使用10000以上）
```

## 日志文件

日志文件保存在 `logs/opensqt.log`，可以通过以下命令查看：

```bash
# 查看实时日志
tail -f logs/opensqt.log

# 查看最近100行
tail -n 100 logs/opensqt.log
```

## 进程管理

### 查看运行状态

```bash
# 查看PID文件
cat .opensqt.pid

# 查看进程
ps aux | grep opensqt
```

### 手动停止

```bash
# 通过PID停止
kill $(cat .opensqt.pid)

# 或直接使用stop.sh
./stop.sh
```

## 注意事项

1. **端口冲突**：脚本会自动处理端口冲突，但建议使用非常见端口
2. **配置文件**：确保配置文件路径正确
3. **权限**：确保脚本有执行权限（`chmod +x *.sh`）
4. **日志目录**：脚本会自动创建 `logs` 目录

## 故障排查

### 服务启动失败

1. 检查配置文件是否存在
2. 检查端口是否被占用：`lsof -i:28888`
3. 查看日志文件：`tail -f logs/opensqt.log`

### 端口被占用

脚本会自动处理，但如果仍有问题：

```bash
# 手动查找并停止占用端口的进程
lsof -ti:28888 | xargs kill -9
```

### 进程无法停止

```bash
# 强制停止所有相关进程
pkill -9 opensqt
```

