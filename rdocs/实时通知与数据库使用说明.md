# å®æ—¶é€šçŸ¥ä¸æ•°æ®åº“ä½¿ç”¨è¯´æ˜

> **åˆ›å»ºæ—¥æœŸ**: 2025-01-27  
> **ç‰ˆæœ¬**: v3.3.1  
> **ç›®çš„**: è¯´æ˜å¦‚ä½•ä½¿ç”¨å®æ—¶é€šçŸ¥ç³»ç»Ÿå’Œæ•°æ®åº“å­˜å‚¨åŠŸèƒ½

---

## ğŸ“‹ ç›®å½•

1. [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
2. [é€šçŸ¥ç³»ç»Ÿé…ç½®](#é€šçŸ¥ç³»ç»Ÿé…ç½®)
3. [æ•°æ®åº“å­˜å‚¨é…ç½®](#æ•°æ®åº“å­˜å‚¨é…ç½®)
4. [ä½¿ç”¨ç¤ºä¾‹](#ä½¿ç”¨ç¤ºä¾‹)
5. [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)

---

## åŠŸèƒ½æ¦‚è¿°

### å®æ—¶é€šçŸ¥ç³»ç»Ÿ

æ”¯æŒå¤šç§é€šçŸ¥æ–¹å¼ï¼š
- **Telegram Bot**: æœ€å®æ—¶ï¼Œæ¨èä½¿ç”¨
- **Webhook**: å¯å¯¹æ¥é’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ç­‰
- **é‚®ä»¶**: æ”¯æŒ SMTPã€Resendã€Mailgun

### æ•°æ®åº“å­˜å‚¨

- **SQLite**: è½»é‡çº§ï¼Œæ–‡ä»¶å¯æ‹·è´
- **å®Œå…¨å¼‚æ­¥**: ä¸å½±å“äº¤æ˜“å†³ç­–
- **è‡ªåŠ¨æ‰¹é‡å†™å…¥**: æé«˜æ€§èƒ½
- **ä¿åº•æ–¹æ¡ˆ**: æ•°æ®åº“å¤±è´¥æ—¶å†™å…¥æ—¥å¿—æ–‡ä»¶

---

## é€šçŸ¥ç³»ç»Ÿé…ç½®

### 1. Telegram é…ç½®

#### æ­¥éª¤1: åˆ›å»º Telegram Bot

1. åœ¨ Telegram ä¸­æœç´¢ `@BotFather`
2. å‘é€ `/newbot` å‘½ä»¤
3. æŒ‰æç¤ºè®¾ç½® Bot åç§°å’Œç”¨æˆ·å
4. è·å– Bot Token

#### æ­¥éª¤2: è·å– Chat ID

1. åœ¨ Telegram ä¸­æœç´¢ `@userinfobot`
2. å‘é€ä»»æ„æ¶ˆæ¯ï¼Œè·å–ä½ çš„ Chat ID

#### æ­¥éª¤3: é…ç½®

```yaml
notifications:
  enabled: true
  
  telegram:
    enabled: true
    bot_token: "123456789:ABCdefGHIjklMNOpqrsTUVwxyz"
    chat_id: "123456789"
```

### 2. Webhook é…ç½®

```yaml
notifications:
  enabled: true
  
  webhook:
    enabled: true
    url: "https://your-webhook-url.com/api/notify"
    timeout: 3  # è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
```

**Webhook è¯·æ±‚æ ¼å¼**:
```json
{
  "type": "order_filled",
  "timestamp": "2025-01-27T10:00:00Z",
  "data": {
    "order_id": 123456,
    "symbol": "ETHUSDT",
    "side": "BUY",
    "price": 3000.0,
    "quantity": 0.01
  }
}
```

### 3. é‚®ä»¶é…ç½®

#### SMTP é…ç½®

```yaml
notifications:
  enabled: true
  
  email:
    enabled: true
    provider: "smtp"
    
    smtp:
      host: "smtp.gmail.com"
      port: 587
      username: "your_email@gmail.com"
      password: "your_app_password"
    
    from: "alerts@yourdomain.com"
    to: "admin@yourdomain.com"
    subject: "OpenSQT äº¤æ˜“é€šçŸ¥"
```

#### Resend é…ç½®

```yaml
notifications:
  enabled: true
  
  email:
    enabled: true
    provider: "resend"
    
    resend:
      api_key: "re_xxxxxxxxxxxxx"
    
    from: "alerts@yourdomain.com"
    to: "admin@yourdomain.com"
```

**æ³¨æ„**: Resend éœ€è¦å®‰è£… `github.com/resend/resend-go/v2` åº“

#### Mailgun é…ç½®

```yaml
notifications:
  enabled: true
  
  email:
    enabled: true
    provider: "mailgun"
    
    mailgun:
      api_key: "key-xxxxxxxxxxxxx"
      domain: "your_domain.com"
    
    from: "alerts@yourdomain.com"
    to: "admin@yourdomain.com"
```

**æ³¨æ„**: Mailgun éœ€è¦å®‰è£… `github.com/mailgun/mailgun-go/v4` åº“

### 4. é€šçŸ¥è§„åˆ™é…ç½®

```yaml
notifications:
  rules:
    order_placed: false    # è®¢å•ä¸‹å•ï¼ˆé»˜è®¤å…³é—­ï¼Œé¿å…é€šçŸ¥è¿‡å¤šï¼‰
    order_filled: true     # è®¢å•æˆäº¤ï¼ˆé»˜è®¤å¼€å¯ï¼‰
    risk_triggered: true   # é£æ§è§¦å‘ï¼ˆé»˜è®¤å¼€å¯ï¼‰
    stop_loss: true        # æ­¢æŸè§¦å‘ï¼ˆé»˜è®¤å¼€å¯ï¼‰
    error: true            # ç³»ç»Ÿé”™è¯¯ï¼ˆé»˜è®¤å¼€å¯ï¼‰
```

---

## æ•°æ®åº“å­˜å‚¨é…ç½®

### åŸºæœ¬é…ç½®

```yaml
storage:
  enabled: true               # æ˜¯å¦å¯ç”¨æ•°æ®å­˜å‚¨
  type: "sqlite"              # å­˜å‚¨ç±»å‹ï¼ˆç›®å‰åªæ”¯æŒ sqliteï¼‰
  path: "./data/opensqt.db"   # æ•°æ®åº“æ–‡ä»¶è·¯å¾„
  buffer_size: 1000           # ç¼“å†²åŒºå¤§å°ï¼ˆé»˜è®¤1000ï¼‰
  batch_size: 100             # æ‰¹é‡å†™å…¥å¤§å°ï¼ˆé»˜è®¤100ï¼‰
  flush_interval: 5           # åˆ·æ–°é—´éš”ï¼ˆç§’ï¼Œé»˜è®¤5ï¼‰
```

### é…ç½®è¯´æ˜

- **buffer_size**: äº‹ä»¶ç¼“å†²åŒºå¤§å°ï¼Œè¶…è¿‡æ­¤æ•°é‡ä¼šä¸¢å¼ƒäº‹ä»¶ï¼ˆä¸é˜»å¡ï¼‰
- **batch_size**: è¾¾åˆ°æ­¤æ•°é‡æ—¶ç«‹å³æ‰¹é‡å†™å…¥æ•°æ®åº“
- **flush_interval**: å®šæœŸåˆ·æ–°é—´éš”ï¼Œå³ä½¿æœªè¾¾åˆ°æ‰¹é‡å¤§å°ä¹Ÿä¼šå®šæœŸå†™å…¥

### æ•°æ®åº“æ–‡ä»¶ä½ç½®

- é»˜è®¤è·¯å¾„: `./data/opensqt.db`
- æ•°æ®åº“æ–‡ä»¶å¯ä»¥éšæ—¶æ‹·è´å’Œå¤‡ä»½
- å»ºè®®å®šæœŸå¤‡ä»½æ•°æ®åº“æ–‡ä»¶

---

## ä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´é…ç½®ç¤ºä¾‹

```yaml
# é€šçŸ¥é…ç½®
notifications:
  enabled: true
  
  telegram:
    enabled: true
    bot_token: "YOUR_BOT_TOKEN"
    chat_id: "YOUR_CHAT_ID"
  
  webhook:
    enabled: false
    url: "https://your-webhook-url.com/api/notify"
    timeout: 3
  
  email:
    enabled: false
    provider: "smtp"
    smtp:
      host: "smtp.gmail.com"
      port: 587
      username: "your_email@gmail.com"
      password: "your_password"
    from: "alerts@yourdomain.com"
    to: "admin@yourdomain.com"
  
  rules:
    order_placed: false
    order_filled: true
    risk_triggered: true
    stop_loss: true
    error: true

# å­˜å‚¨é…ç½®
storage:
  enabled: true
  type: "sqlite"
  path: "./data/opensqt.db"
  buffer_size: 1000
  batch_size: 100
  flush_interval: 5
```

### å¯åŠ¨ç³»ç»Ÿ

```bash
go run main.go config.yaml
```

ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. åˆå§‹åŒ–äº‹ä»¶æ€»çº¿
2. å¯åŠ¨é€šçŸ¥æœåŠ¡ï¼ˆå¦‚æœå¯ç”¨ï¼‰
3. å¯åŠ¨å­˜å‚¨æœåŠ¡ï¼ˆå¦‚æœå¯ç”¨ï¼‰
4. åœ¨å…³é”®ä½ç½®å‘å¸ƒäº‹ä»¶

---

## æ³¨æ„äº‹é¡¹

### 1. é€šçŸ¥ç³»ç»Ÿ

- âœ… **å®Œå…¨å¼‚æ­¥**: é€šçŸ¥å¤±è´¥ä¸ä¼šå½±å“äº¤æ˜“
- âœ… **è¶…æ—¶æ§åˆ¶**: æ‰€æœ‰ç½‘ç»œè¯·æ±‚éƒ½æœ‰è¶…æ—¶ï¼ˆ3ç§’ï¼‰
- âœ… **éé˜»å¡**: é€šçŸ¥å‘é€ä¸ä¼šé˜»å¡äº¤æ˜“æµç¨‹
- âš ï¸ **Channel æ»¡**: å¦‚æœäº‹ä»¶é˜Ÿåˆ—æ»¡äº†ï¼Œä¼šä¸¢å¼ƒäº‹ä»¶å¹¶è®°å½•è­¦å‘Š

### 2. æ•°æ®åº“å­˜å‚¨

- âœ… **å®Œå…¨å¼‚æ­¥**: æ•°æ®åº“æ“ä½œä¸ä¼šå½±å“äº¤æ˜“å†³ç­–
- âœ… **æ‰¹é‡å†™å…¥**: æé«˜æ€§èƒ½ï¼Œå‡å°‘æ•°æ®åº“æ“ä½œ
- âœ… **ä¿åº•æ–¹æ¡ˆ**: æ•°æ®åº“å¤±è´¥æ—¶å†™å…¥æ—¥å¿—æ–‡ä»¶
- âš ï¸ **æ•°æ®ç›®å½•**: ç¡®ä¿ `data/` ç›®å½•æœ‰å†™å…¥æƒé™
- âš ï¸ **ç£ç›˜ç©ºé—´**: å®šæœŸæ£€æŸ¥ç£ç›˜ç©ºé—´ï¼Œé¿å…æ•°æ®åº“æ–‡ä»¶è¿‡å¤§

### 3. æ€§èƒ½è€ƒè™‘

- **ç¼“å†²åŒºå¤§å°**: æ ¹æ®ç³»ç»Ÿè´Ÿè½½è°ƒæ•´ `buffer_size`
- **æ‰¹é‡å¤§å°**: æ ¹æ®äº¤æ˜“é¢‘ç‡è°ƒæ•´ `batch_size`
- **åˆ·æ–°é—´éš”**: æ ¹æ®å®æ—¶æ€§è¦æ±‚è°ƒæ•´ `flush_interval`

### 4. æ•…éšœå¤„ç†

#### é€šçŸ¥å¤±è´¥

- é€šçŸ¥å¤±è´¥åªè®°å½•è­¦å‘Šæ—¥å¿—ï¼Œä¸å½±å“äº¤æ˜“
- æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé…ç½®æ˜¯å¦æ­£ç¡®
- æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶äº†è§£è¯¦ç»†é”™è¯¯ä¿¡æ¯

#### æ•°æ®åº“å¤±è´¥

- æ•°æ®åº“å¤±è´¥æ—¶ä¼šè‡ªåŠ¨é™çº§åˆ°æ—¥å¿—æ–‡ä»¶
- æ£€æŸ¥æ—¥å¿—æ–‡ä»¶: `./data/storage_fallback.log`
- æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æƒé™å’Œç£ç›˜ç©ºé—´
- æ•°æ®åº“æ–‡ä»¶æŸåæ—¶å¯ä»¥åˆ é™¤åé‡æ–°åˆ›å»º

---

## äº‹ä»¶ç±»å‹è¯´æ˜

ç³»ç»Ÿä¼šå‘å¸ƒä»¥ä¸‹äº‹ä»¶ï¼š

| äº‹ä»¶ç±»å‹ | è¯´æ˜ | é»˜è®¤é€šçŸ¥ |
|---------|------|---------|
| `order_placed` | è®¢å•ä¸‹å• | âŒ å…³é—­ |
| `order_filled` | è®¢å•æˆäº¤ | âœ… å¼€å¯ |
| `order_canceled` | è®¢å•å–æ¶ˆ | âŒ å…³é—­ |
| `risk_triggered` | é£æ§è§¦å‘ | âœ… å¼€å¯ |
| `risk_recovered` | é£æ§è§£é™¤ | âœ… å¼€å¯ |
| `stop_loss` | æ­¢æŸè§¦å‘ | âœ… å¼€å¯ |
| `take_profit` | æ­¢ç›ˆè§¦å‘ | âœ… å¼€å¯ |
| `error` | ç³»ç»Ÿé”™è¯¯ | âœ… å¼€å¯ |
| `system_start` | ç³»ç»Ÿå¯åŠ¨ | âœ… å¼€å¯ |
| `system_stop` | ç³»ç»Ÿåœæ­¢ | âœ… å¼€å¯ |

---

## æ•°æ®åº“è¡¨ç»“æ„

### orders è¡¨ï¼ˆè®¢å•è¡¨ï¼‰

```sql
CREATE TABLE orders (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    order_id BIGINT UNIQUE,
    client_order_id TEXT,
    symbol TEXT,
    side TEXT,
    price DECIMAL(20,8),
    quantity DECIMAL(20,8),
    status TEXT,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

### positions è¡¨ï¼ˆæŒä»“è¡¨ï¼‰

```sql
CREATE TABLE positions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    slot_price DECIMAL(20,8),
    symbol TEXT,
    size DECIMAL(20,8),
    entry_price DECIMAL(20,8),
    current_price DECIMAL(20,8),
    pnl DECIMAL(20,8),
    opened_at TIMESTAMP,
    closed_at TIMESTAMP
);
```

### trades è¡¨ï¼ˆäº¤æ˜“è¡¨ï¼‰

```sql
CREATE TABLE trades (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    buy_order_id BIGINT,
    sell_order_id BIGINT,
    symbol TEXT,
    buy_price DECIMAL(20,8),
    sell_price DECIMAL(20,8),
    quantity DECIMAL(20,8),
    pnl DECIMAL(20,8),
    created_at TIMESTAMP
);
```

### events è¡¨ï¼ˆäº‹ä»¶è¡¨ï¼‰

```sql
CREATE TABLE events (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    event_type TEXT,
    data TEXT,  -- JSON æ ¼å¼
    created_at TIMESTAMP
);
```

### statistics è¡¨ï¼ˆç»Ÿè®¡è¡¨ï¼‰

```sql
CREATE TABLE statistics (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    date DATE UNIQUE,
    total_trades INTEGER,
    total_volume DECIMAL(20,8),
    total_pnl DECIMAL(20,8),
    win_rate DECIMAL(5,2),
    created_at TIMESTAMP
);
```

---

## æŸ¥è¯¢ç¤ºä¾‹

### æŸ¥è¯¢æœ€è¿‘çš„è®¢å•

```sql
SELECT * FROM orders 
ORDER BY created_at DESC 
LIMIT 10;
```

### æŸ¥è¯¢ä»Šæ—¥ç›ˆäº

```sql
SELECT 
    SUM(pnl) as total_pnl,
    COUNT(*) as trade_count
FROM trades 
WHERE DATE(created_at) = DATE('now');
```

### æŸ¥è¯¢é£æ§è§¦å‘è®°å½•

```sql
SELECT * FROM events 
WHERE event_type = 'risk_triggered'
ORDER BY created_at DESC;
```

---

## æ€»ç»“

### æ ¸å¿ƒç‰¹æ€§

1. **å®Œå…¨å¼‚æ­¥**: æ‰€æœ‰æ“ä½œä¸é˜»å¡äº¤æ˜“æµç¨‹
2. **å¤šç§é€šçŸ¥**: æ”¯æŒ Telegramã€Webhookã€é‚®ä»¶
3. **æ•°æ®æŒä¹…åŒ–**: SQLite æ•°æ®åº“ï¼Œæ–‡ä»¶å¯æ‹·è´
4. **ä¿åº•æ–¹æ¡ˆ**: æ•°æ®åº“å¤±è´¥æ—¶å†™å…¥æ—¥å¿—æ–‡ä»¶
5. **å¯é…ç½®**: çµæ´»é…ç½®é€šçŸ¥è§„åˆ™å’Œå­˜å‚¨å‚æ•°

### æ¨èé…ç½®

- **é€šçŸ¥**: ä¼˜å…ˆä½¿ç”¨ Telegramï¼ˆæœ€å®æ—¶ï¼‰
- **å­˜å‚¨**: å¯ç”¨ SQLiteï¼Œå®šæœŸå¤‡ä»½æ•°æ®åº“æ–‡ä»¶
- **è§„åˆ™**: åªé€šçŸ¥é‡è¦äº‹ä»¶ï¼Œé¿å…é€šçŸ¥è¿‡å¤š

---

**ç›¸å…³æ–‡æ¡£**:
- [æŠ€æœ¯æ¶æ„åˆ†æ.md](./æŠ€æœ¯æ¶æ„åˆ†æ.md) - äº†è§£ç³»ç»Ÿæ¶æ„
- [åŠŸèƒ½æ‰©å±•è§„åˆ’.md](./åŠŸèƒ½æ‰©å±•è§„åˆ’.md) - äº†è§£åŠŸèƒ½è§„åˆ’

---

*æœ¬æ–‡æ¡£è¯´æ˜äº†å®æ—¶é€šçŸ¥ç³»ç»Ÿå’Œæ•°æ®åº“å­˜å‚¨çš„ä½¿ç”¨æ–¹æ³•ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œä¸ä¼šå½±å“äº¤æ˜“å†³ç­–ã€‚*

