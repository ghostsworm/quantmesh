# 网格交易策略详解

> **版本**: v3.3.2  
> **更新时间**: 2025-01-27

---

## 目录

1. [策略原理](#策略原理)
2. [固定金额模式](#固定金额模式)
3. [参数配置说明](#参数配置说明)
4. [盈利机制](#盈利机制)
5. [风险说明](#风险说明)
6. [配置建议](#配置建议)

---

## 策略原理

### 什么是网格交易？

网格交易是一种量化交易策略，通过在设定的价格区间内，按固定间隔挂买单和卖单，利用价格波动赚取价差利润。

### 工作原理

```
价格走势图：

    卖单 ↑  ↑  ↑  ↑  ↑
    ────────────────────
    当前价格 ●
    ────────────────────
    买单 ↓  ↓  ↓  ↓  ↓
```

**工作流程：**

1. **初始化**: 系统启动时，以当前价格为锚点
2. **挂买单**: 在下方按固定间隔挂买单（如每 2 美元一个）
3. **挂卖单**: 在上方按固定间隔挂卖单（如每 2 美元一个）
4. **价格下跌**: 买单成交，获得持仓
5. **价格上涨**: 卖单成交，卖出持仓，赚取价差
6. **循环往复**: 持续交易，赚取价差利润

### 核心特点

- ✅ **单向做多**: 只做多，不做空（低买高卖）
- ✅ **无限网格**: 不设上下限，自动跟随价格波动
- ✅ **固定金额**: 每单投入固定金额（而非固定数量）
- ✅ **自动调整**: 价格变化时自动调整订单窗口

---

## 固定金额模式

### 传统网格 vs QuantMesh

#### 传统网格（固定数量）

```
每次买入固定数量（如 0.01 BTC）
- 价格 50000 时：买入 0.01 BTC = 500 USDT
- 价格 30000 时：买入 0.01 BTC = 300 USDT
- 价格 10000 时：买入 0.01 BTC = 100 USDT
```

**问题：**
- 资金利用率不一致
- 低价时投入少，高价时投入多
- 难以控制风险

#### QuantMesh（固定金额）

```
每次买入固定金额（如 30 USDT）
- 价格 50000 时：买入 30 USDT = 0.0006 BTC
- 价格 30000 时：买入 30 USDT = 0.001 BTC
- 价格 10000 时：买入 30 USDT = 0.003 BTC
```

**优势：**
- ✅ 资金利用率更可控
- ✅ 每单投入相同，风险均匀
- ✅ 适配不同价格区间
- ✅ 方便资金管理和风控

### 实际示例

**ETH 配置（每单赚 1 美元）：**

```yaml
price_interval: 1      # 价格间隔：1 美元
order_quantity: 30     # 每单投入：30 USDT
```

**效果：**
- 价格 3000 时：买入 30 USDT = 0.01 ETH
- 价格 1500 时：买入 30 USDT = 0.02 ETH
- 每单赚取 1 美元价差

**ETH 配置（每单赚 10 美元）：**

```yaml
price_interval: 10     # 价格间隔：10 美元
order_quantity: 300    # 每单投入：300 USDT（需要大量保证金）
```

---

## 参数配置说明

### 核心参数

#### 1. price_interval（价格间隔）

**说明：** 网格中相邻订单之间的价格差

**单位：** 美元（或交易对的计价货币）

**建议值：**
- ETH: 1-2 美元
- BTC: 5-10 美元
- DOGE: 0.0001 美元

**设置原则：**
- 太小：订单频繁成交，手续费成本高
- 太大：成交机会少，资金利用率低
- 建议：根据币种波动性设置，约为日均波动的 1-2%

#### 2. order_quantity（每单投入金额）

**说明：** 每个网格点投入的固定金额

**单位：** USDT（或交易对的计价货币）

**建议值：** 20-50 USDT（根据资金量调整）

**设置原则：**
- 根据总资金量设置
- 确保有足够保证金支持多个网格点
- 建议：总资金 / (buy_window_size + sell_window_size) / 2

#### 3. buy_window_size（买单窗口大小）

**说明：** 当前价格下方挂的买单数量

**建议值：** 8-20

**设置原则：**
- 太小：覆盖范围小，可能错过买入机会
- 太大：占用保证金多，可能超出资金能力
- 建议：根据资金量和价格波动范围设置

#### 4. sell_window_size（卖单窗口大小）

**说明：** 当前价格上方挂的卖单数量

**建议值：** 8-20

**设置原则：**
- 与 `buy_window_size` 类似
- 建议与 `buy_window_size` 相同或相近

### 完整配置示例

```yaml
trading:
  symbol: "ETHUSDT"
  price_interval: 2         # 价格间隔：2 美元
  order_quantity: 30        # 每单投入：30 USDT
  min_order_value: 20       # 最小订单价值：20 USDT
  buy_window_size: 10       # 下方买单：10 个
  sell_window_size: 10      # 上方卖单：10 个
```

### 参数关系

```
总资金需求 = order_quantity × (buy_window_size + sell_window_size) × 杠杆倍数

示例：
- order_quantity = 30 USDT
- buy_window_size = 10
- sell_window_size = 10
- 杠杆倍数 = 10

总资金需求 = 30 × 20 × 10 = 6000 USDT
```

---

## 盈利机制

### 盈利来源

网格交易的盈利主要来自：

1. **价差利润**: 低买高卖赚取价差
2. **频繁交易**: 价格在网格区间内波动，持续交易
3. **手续费优势**: 使用 Maker 订单（PostOnly），可能获得手续费返还

### 盈利计算

**单笔交易盈利：**

```
盈利 = (卖出价格 - 买入价格) × 数量 - 手续费

示例：
- 买入价格：3000 USDT
- 卖出价格：3002 USDT（price_interval = 2）
- 数量：0.01 ETH（order_quantity = 30）
- 手续费：0.04%（Taker）

盈利 = (3002 - 3000) × 0.01 - 30 × 0.0004 × 2
     = 0.02 - 0.024
     = -0.004 USDT（亏损，因为手续费）
```

**注意：** 如果手续费率过高，可能无法盈利。建议：
- 使用 Maker 订单（PostOnly），获得手续费返还
- 选择手续费率低的交易所
- 提高 VIP 等级，降低手续费率

### 盈利场景

#### 场景 1: 震荡市场（最佳）

```
价格在网格区间内反复波动
- 持续买入和卖出
- 每笔交易赚取价差
- 累计盈利可观
```

#### 场景 2: 上涨市场

```
价格持续上涨
- 买单逐步成交
- 卖单逐步上移
- 持仓盈利增加
- 最终卖出获得利润
```

#### 场景 3: 下跌市场

```
价格持续下跌
- 买单持续成交
- 持仓成本逐步降低
- 等待价格回升
- 只要回涨 50% 即可保本
```

---

## 风险说明

### 主要风险

#### 1. 单边下跌风险

**风险：** 价格持续下跌，买单不断成交，持仓亏损增加

**应对：**
- 系统有主动风控，检测到异常会自动暂停交易
- 通过不断交易拉低成本
- 只要回涨 50% 即可保本
- 设置合理的 `position_safety_check` 参数

#### 2. 流动性风险

**风险：** 市场深度不足，订单无法及时成交

**应对：**
- 选择主流交易对（如 BTC、ETH）
- 避免选择流动性差的币种

#### 3. 手续费风险

**风险：** 手续费率过高，价差利润无法覆盖手续费

**应对：**
- 使用 Maker 订单（PostOnly）
- 选择手续费率低的交易所
- 提高 VIP 等级
- 设置合理的 `price_interval`（不能太小）

#### 4. 技术风险

**风险：** 网络延迟、交易所 API 故障等

**应对：**
- 系统有自动重连机制
- 定期对账确保数据一致性
- 监控系统运行状态

### 风险控制

系统内置多层风控机制：

1. **启动前检查**: 验证账户余额、杠杆倍数
2. **主动风控**: 监控市场异常，自动暂停交易
3. **持仓对账**: 定期同步本地与交易所状态
4. **订单清理**: 自动清理过期订单

更多详情请参阅 [风控系统介绍](./05-风控系统.md)。

---

## 配置建议

### ETH 配置建议

#### 保守配置（每单赚 1 美元）

```yaml
symbol: "ETHUSDT"
price_interval: 1      # 价格间隔：1 美元
order_quantity: 30     # 每单投入：30 USDT
buy_window_size: 10    # 下方买单：10 个
sell_window_size: 10    # 上方卖单：10 个
```

**特点：**
- 成交频率高
- 单笔盈利小
- 适合震荡市场

#### 激进配置（每单赚 10 美元）

```yaml
symbol: "ETHUSDT"
price_interval: 10     # 价格间隔：10 美元
order_quantity: 300     # 每单投入：300 USDT
buy_window_size: 10    # 下方买单：10 个
sell_window_size: 10   # 上方卖单：10 个
```

**特点：**
- 成交频率低
- 单笔盈利大
- 需要大量保证金

### BTC 配置建议

```yaml
symbol: "BTCUSDT"
price_interval: 10      # 价格间隔：10 美元
order_quantity: 50      # 每单投入：50 USDT
buy_window_size: 8      # 下方买单：8 个
sell_window_size: 8     # 上方卖单：8 个
```

### DOGE 配置建议

```yaml
symbol: "DOGEUSDT"
price_interval: 0.0001  # 价格间隔：0.0001 美元
order_quantity: 20       # 每单投入：20 USDT
buy_window_size: 10      # 下方买单：10 个
sell_window_size: 10     # 上方卖单：10 个
```

### 通用建议

1. **首次使用**: 建议使用测试网或小额资金
2. **参数调整**: 根据市场情况逐步调整
3. **资金管理**: 不要投入全部资金，保留缓冲
4. **监控运行**: 定期检查系统运行状态
5. **风控设置**: 必须启用风控功能

---

## 最佳实践

### 1. 市场选择

- ✅ 选择主流交易对（BTC、ETH 等）
- ✅ 选择流动性好的交易所
- ✅ 避免选择波动性过大的币种

### 2. 参数设置

- ✅ 根据资金量设置 `order_quantity`
- ✅ 根据波动性设置 `price_interval`
- ✅ 确保有足够保证金支持网格

### 3. 风险控制

- ✅ 启用风控功能
- ✅ 设置合理的 `position_safety_check`
- ✅ 定期检查持仓和盈亏

### 4. 资金管理

- ✅ 不要投入全部资金
- ✅ 保留足够的保证金缓冲
- ✅ 根据市场情况调整资金量

---

## 下一步

- 🏦 [支持的交易所](./04-支持的交易所.md) - 查看支持的交易所列表
- 🛡️ [风控系统介绍](./05-风控系统.md) - 了解安全机制
- 💡 [使用场景与案例](./06-使用场景.md) - 查看实际应用场景
- ❓ [常见问题 FAQ](./07-常见问题.md) - 解答常见疑问

---

*网格交易策略需要根据市场情况灵活调整，建议先在测试网或小额资金上验证策略有效性。*

