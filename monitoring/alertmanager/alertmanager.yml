global:
  resolve_timeout: 5m

# å‘Šè­¦è·¯ç”±é…ç½®
route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 12h
  receiver: 'default'
  
  routes:
    # P0 çº§åˆ«å‘Šè­¦ï¼šç«‹å³å‘é€ï¼Œä¸èšåˆ
    - match:
        severity: P0
      receiver: 'telegram-p0'
      group_wait: 0s
      group_interval: 1m
      repeat_interval: 5m
      continue: true
    
    # P1 çº§åˆ«å‘Šè­¦ï¼š5åˆ†é’Ÿèšåˆ
    - match:
        severity: P1
      receiver: 'telegram-p1'
      group_wait: 5m
      group_interval: 5m
      repeat_interval: 1h
      continue: true
    
    # P2 çº§åˆ«å‘Šè­¦ï¼š10åˆ†é’Ÿèšåˆ
    - match:
        severity: P2
      receiver: 'telegram-p2'
      group_wait: 10m
      group_interval: 10m
      repeat_interval: 4h

# å‘Šè­¦æ¥æ”¶å™¨é…ç½®
receivers:
  - name: 'default'
    webhook_configs:
      - url: 'http://host.docker.internal:28888/api/alerts/webhook'
        send_resolved: true

  # Telegram å‘Šè­¦ï¼ˆP0 çº§åˆ«ï¼‰
  - name: 'telegram-p0'
    telegram_configs:
      - bot_token: 'YOUR_BOT_TOKEN'
        chat_id: YOUR_CHAT_ID
        parse_mode: 'HTML'
        message: |
          ğŸš¨ <b>P0 çº§åˆ«å‘Šè­¦</b> ğŸš¨
          
          <b>å‘Šè­¦åç§°:</b> {{ .GroupLabels.alertname }}
          <b>ä¸¥é‡ç¨‹åº¦:</b> {{ .CommonLabels.severity }}
          <b>åˆ†ç±»:</b> {{ .CommonLabels.category }}
          
          {{ range .Alerts }}
          <b>æè¿°:</b> {{ .Annotations.description }}
          <b>æ—¶é—´:</b> {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}

  # Telegram å‘Šè­¦ï¼ˆP1 çº§åˆ«ï¼‰
  - name: 'telegram-p1'
    telegram_configs:
      - bot_token: 'YOUR_BOT_TOKEN'
        chat_id: YOUR_CHAT_ID
        parse_mode: 'HTML'
        message: |
          âš ï¸ <b>P1 çº§åˆ«å‘Šè­¦</b>
          
          <b>å‘Šè­¦åç§°:</b> {{ .GroupLabels.alertname }}
          <b>æ•°é‡:</b> {{ .Alerts | len }}
          
          {{ range .Alerts }}
          â€¢ {{ .Annotations.summary }}
          {{ end }}

  # Telegram å‘Šè­¦ï¼ˆP2 çº§åˆ«ï¼‰
  - name: 'telegram-p2'
    telegram_configs:
      - bot_token: 'YOUR_BOT_TOKEN'
        chat_id: YOUR_CHAT_ID
        parse_mode: 'HTML'
        message: |
          â„¹ï¸ <b>P2 çº§åˆ«å‘Šè­¦</b>
          
          <b>å‘Šè­¦åç§°:</b> {{ .GroupLabels.alertname }}
          <b>æ•°é‡:</b> {{ .Alerts | len }}
          
          {{ range .Alerts }}
          â€¢ {{ .Annotations.summary }}
          {{ end }}

# å‘Šè­¦æŠ‘åˆ¶è§„åˆ™
inhibit_rules:
  # å½“ QuantMesh æœåŠ¡åœæ­¢æ—¶ï¼ŒæŠ‘åˆ¶å…¶ä»–æ‰€æœ‰å‘Šè­¦
  - source_match:
      alertname: 'QuantMeshDown'
    target_match_re:
      alertname: '.*'
    equal: ['instance']
  
  # å½“é£æ§è§¦å‘æ—¶ï¼ŒæŠ‘åˆ¶è®¢å•ç›¸å…³å‘Šè­¦
  - source_match:
      alertname: 'RiskControlTriggered'
    target_match:
      category: 'trading'
    equal: ['exchange', 'symbol']

